# UITableView 重用机制

<img src="image-20230129130833299.png" alt="image-20230129130833299" style="zoom:50%;" />

当Cell要显示的时候，会判断重用池中有没有可用Cell，如果有福永重用池中的Cell，如果没有，新创建。当Cell显示消失的时候，会被加入到重用池中。



# 数据源同步问题





# UIView 和 CALayer

![image-20230129154947436](image-20230129154947436.png)



![image-20230129155002039](image-20230129155002039.png)



# 事件传递与视图响应链

![image-20230129155153765](image-20230129155153765.png)

<img src="image-20230129155307779.png" alt="image-20230129155307779" style="zoom:50%;" />



<img src="image-20230129155358812.png" alt="image-20230129155358812" style="zoom:50%;" />

<img src="image-20230129155806924.png" alt="image-20230129155806924" style="zoom:50%;" />



# 图像显示原理

![image-20230129160019706](image-20230129160019706.png)

![image-20230129160102361](image-20230129160102361.png)



- CPU部分

    - Layout
        - UI布局
        - 文本计算
    - Display
        - 绘制
    - Prepare
        - 图片编解码
    - Commit
        - 提交位图

- GPU部分

    ![image-20230129160544099](image-20230129160544099.png)



# UI卡顿/掉帧的原因

![image-20230129160751172](image-20230129160751172.png)



### 滑动优化方案

- CPU
    - 对象创建/调整/销毁，放到子线程
    - 预排版（布局计算/文本计算）
    - 预渲染（文本等异步绘制/图片编解码等）
- GPU
    - 纹理渲染
    - 视图混合





![image-20230129161452082](image-20230129161452082.png)

![image-20230129161610658](image-20230129161610658.png)



# 异步绘制



![image-20230129161815644](image-20230129161815644.png)



![image-20230129161749876](image-20230129161749876.png)





# 离屏渲染

